{% extends "base.html" %}
{% block title %}Post a Job - QuickHire{% endblock %}
{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Page Header -->
            <div class="text-center mb-5">
                <h1 class="display-5 fw-bold text-gradient mb-3">
                    <i class="fas fa-plus-circle me-2"></i>Post a New Job
                </h1>
                <p class="lead text-muted-dark">Create a job listing to attract talented candidates for your opportunity</p>
            </div>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category == 'error' and 'danger' or 'success' }} alert-modern mb-4" role="alert">
                            <i class="fas fa-{{ category == 'error' and 'exclamation-triangle' or 'check-circle' }} me-2"></i>
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Job Posting Form -->
            <div class="card card-modern shadow-lg">
                <div class="card-header card-header-modern">
                    <h4 class="mb-0 text-white">
                        <i class="fas fa-briefcase me-2"></i>Job Details
                    </h4>
                </div>
                <div class="card-body p-4 p-md-5">
                    <form method="POST" action="" novalidate class="needs-validation">
                        {{ form.hidden_tag() }}  <!-- This includes CSRF token -->
                        
                        <!-- Job Title -->
                        <div class="mb-4">
                            <label for="title" class="form-label fw-semibold">
                                <i class="fas fa-heading me-2 text-primary"></i>Job Title
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-transparent">
                                    <i class="fas fa-briefcase text-muted"></i>
                                </span>
                                {{ form.title(class="form-control", placeholder="e.g., Professional Home Cook Needed", id="title") }}
                            </div>
                            {% if form.title.errors %}
                                <div class="text-danger small mt-2">
                                    <i class="fas fa-exclamation-circle me-1"></i>
                                    {{ form.title.errors[0] }}
                                </div>
                            {% endif %}
                            <div class="form-text">Be specific about the role to attract the right candidates</div>
                        </div>

                        <!-- Job Description -->
                        <div class="mb-4">
                            <label for="description" class="form-label fw-semibold">
                                <i class="fas fa-align-left me-2 text-primary"></i>Job Description
                            </label>
                            {{ form.description(class="form-control", rows="6", placeholder="Describe the job responsibilities, expectations, and what makes this opportunity great...", id="description") }}
                            {% if form.description.errors %}
                                <div class="text-danger small mt-2">
                                    <i class="fas fa-exclamation-circle me-1"></i>
                                    {{ form.description.errors[0] }}
                                </div>
                            {% endif %}
                            <div class="form-text">Provide clear details about daily tasks and requirements</div>
                        </div>

                        <div class="row g-4">
                            <!-- Salary -->
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <label for="pay" class="form-label fw-semibold">
                                        <i class="fas fa-rupee-sign me-2 text-primary"></i>Salary/Month
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-transparent">
                                            <i class="fas fa-indian-rupee-sign text-muted"></i>
                                        </span>
                                        {{ form.pay(class="form-control", placeholder="e.g., 15000", id="pay") }}
                                    </div>
                                    {% if form.pay.errors %}
                                        <div class="text-danger small mt-2">
                                            <i class="fas fa-exclamation-circle me-1"></i>
                                            {{ form.pay.errors[0] }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Monthly salary in Indian Rupees</div>
                                </div>
                            </div>

                            <!-- Location -->
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <label for="location" class="form-label fw-semibold">
                                        <i class="fas fa-map-marker-alt me-2 text-primary"></i>Job Location
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-transparent">
                                            <i class="fas fa-location-dot text-muted"></i>
                                        </span>
                                        {{ form.location(class="form-control", placeholder="e.g., Aurangabad", id="location") }}
                                    </div>
                                    {% if form.location.errors %}
                                        <div class="text-danger small mt-2">
                                            <i class="fas fa-exclamation-circle me-1"></i>
                                            {{ form.location.errors[0] }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">City or area where the job is located</div>
                                </div>
                            </div>
                        </div>

                        <!-- Required Skills -->
                        <div class="mb-4">
                            <label for="required_skills" class="form-label fw-semibold">
                                <i class="fas fa-tools me-2 text-primary"></i>Required Skills
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-transparent">
                                    <i class="fas fa-wrench text-muted"></i>
                                </span>
                                {{ form.required_skills(class="form-select", id="required_skills") }}
                            </div>
                            
                            <!-- Other Skill Input (Hidden by Default) -->
                            <div id="other-skill-input" class="mt-3" style="display:none;">
                                <label for="other_skill" class="form-label fw-semibold small">
                                    <i class="fas fa-pen me-1 text-primary"></i>Specify Skill
                                </label>
                                <input type="text" name="other_skill" class="form-control" id="other_skill" placeholder="Enter the specific skill required">
                                <div class="form-text">Describe the specific skill you're looking for</div>
                            </div>
                            
                            {% if form.required_skills.errors %}
                                <div class="text-danger small mt-2">
                                    <i class="fas fa-exclamation-circle me-1"></i>
                                    {{ form.required_skills.errors[0] }}
                                </div>
                            {% endif %}
                            <div class="form-text">Select the primary skill required for this job</div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4 pt-3 border-top">
                            <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary me-md-2">
                                <i class="fas fa-arrow-left me-2"></i>Cancel
                            </a>
                            {{ form.submit(class="btn btn-primary btn-lg") }}
                        </div>
                    </form>
                </div>
            </div>

            <!-- Help Section -->
            <div class="card card-modern mt-4">
                <div class="card-body">
                    <h5 class="fw-semibold mb-3">
                        <i class="fas fa-lightbulb me-2 text-warning"></i>Tips for a Great Job Post
                    </h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <i class="fas fa-check-circle text-success me-2 mt-1"></i>
                                <div>
                                    <strong>Be Specific</strong>
                                    <p class="small text-muted mb-0">Clearly describe responsibilities and expectations</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <i class="fas fa-check-circle text-success me-2 mt-1"></i>
                                <div>
                                    <strong>Set Realistic Salary</strong>
                                    <p class="small text-muted mb-0">Competitive pay attracts better candidates</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <i class="fas fa-check-circle text-success me-2 mt-1"></i>
                                <div>
                                    <strong>Highlight Benefits</strong>
                                    <p class="small text-muted mb-0">Mention any perks or flexible arrangements</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <i class="fas fa-check-circle text-success me-2 mt-1"></i>
                                <div>
                                    <strong>Clear Requirements</strong>
                                    <p class="small text-muted mb-0">Specify must-have skills and experience</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const skillsSelect = document.getElementById('required_skills');
    const otherInput = document.getElementById('other-skill-input');
    
    // Toggle other skill input based on selection
    if (skillsSelect && otherInput) {
        skillsSelect.addEventListener('change', function() {
            if (this.value === 'Other') {
                otherInput.style.display = 'block';
            } else {
                otherInput.style.display = 'none';
                // Clear other skill input when not needed
                const otherSkillInput = document.getElementById('other_skill');
                if (otherSkillInput) {
                    otherSkillInput.value = '';
                }
            }
        });
        
        // Initialize on page load
        if (skillsSelect.value === 'Other') {
            otherInput.style.display = 'block';
        }
    }
    
    // Form validation
    const form = document.querySelector('.needs-validation');
    if (form) {
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    }
    
    // Character count for description
    const descriptionField = document.getElementById('description');
    if (descriptionField) {
        // Create character counter
        const counter = document.createElement('div');
        counter.className = 'form-text text-end';
        counter.id = 'description-counter';
        descriptionField.parentNode.appendChild(counter);
        
        function updateCounter() {
            const count = descriptionField.value.length;
            counter.textContent = `${count}/1000 characters`;
            
            if (count > 800) {
                counter.classList.add('text-warning');
            } else {
                counter.classList.remove('text-warning');
            }
            
            if (count > 1000) {
                counter.classList.add('text-danger');
            } else {
                counter.classList.remove('text-danger');
            }
        }
        
        descriptionField.addEventListener('input', updateCounter);
        updateCounter(); // Initial count
    }
    
    // Salary formatting
    const salaryField = document.getElementById('pay');
    if (salaryField) {
        salaryField.addEventListener('blur', function() {
            const value = parseFloat(this.value);
            if (!isNaN(value) && value > 0) {
                this.value = Math.round(value); // Round to nearest whole number
            }
        });
    }
});
</script>

<style>
/* Form Styling */
.needs-validation .form-control {
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: 0.875rem 1rem;
    font-size: 1rem;
    transition: all var(--transition-fast);
    background: var(--bg-card);
    color: var(--text-primary);
}

.needs-validation .form-control:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.15);
    background: var(--bg-card);
    color: var(--text-primary);
}

.needs-validation .form-label {
    color: var(--text-primary);
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.needs-validation .input-group-text {
    background: var(--bg-secondary);
    border: 2px solid var(--border-color);
    border-right: none;
    color: var(--text-secondary);
}

.needs-validation .form-text {
    color: var(--text-muted);
    font-size: 0.875rem;
}

/* Card Styling */
.card-modern {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    transition: all var(--transition-normal);
}

.card-modern:hover {
    box-shadow: var(--shadow-lg);
}

.card-header-modern {
    background: var(--gradient-primary);
    color: white;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0 !important;
    padding: 1.5rem 2rem;
    border: none;
}

/* Button Styling */
.btn {
    border-radius: var(--radius-md);
    padding: 0.875rem 2rem;
    font-weight: 600;
    transition: all var(--transition-fast);
    border: 2px solid transparent;
}

.btn-primary {
    background: var(--gradient-primary);
    border-color: transparent;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: var(--gradient-primary);
    border-color: transparent;
}

.btn-outline-secondary {
    border-color: var(--border-color);
    color: var(--text-secondary);
}

.btn-outline-secondary:hover {
    background: var(--bg-secondary);
    border-color: var(--border-color);
    color: var(--text-primary);
    transform: translateY(-1px);
}

/* Select Dropdown Styling */
.form-select {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    color: var(--text-primary);
    border-radius: var(--radius-md);
    padding: 0.875rem 1rem;
}

.form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.15);
    background: var(--bg-card);
    color: var(--text-primary);
}

/* Textarea Styling */
textarea.form-control {
    resize: vertical;
    min-height: 120px;
}

/* Validation Styles */
.was-validated .form-control:valid {
    border-color: var(--success);
}

.was-validated .form-control:invalid {
    border-color: var(--danger);
}

/* Dark Mode Specific Adjustments */
[data-theme="dark"] .form-control,
[data-theme="dark"] .form-select {
    background: var(--gray-800);
    border-color: var(--gray-700);
    color: var(--gray-100);
}

[data-theme="dark"] .form-control:focus,
[data-theme="dark"] .form-select:focus {
    background: var(--gray-800);
    border-color: var(--primary);
    color: var(--gray-100);
}

[data-theme="dark"] .input-group-text {
    background: var(--gray-700);
    border-color: var(--gray-600);
    color: var(--gray-300);
}

[data-theme="dark"] .card-modern {
    background: var(--gray-800);
    border-color: var(--gray-700);
}

[data-theme="dark"] .btn-outline-secondary {
    border-color: var(--gray-600);
    color: var(--gray-300);
}

[data-theme="dark"] .btn-outline-secondary:hover {
    background: var(--gray-700);
    border-color: var(--gray-500);
    color: var(--gray-100);
}

/* Responsive Design */
@media (max-width: 768px) {
    .card-body {
        padding: 1.5rem !important;
    }
    
    .display-5 {
        font-size: 2rem;
    }
    
    .btn {
        padding: 0.75rem 1.5rem;
    }
    
    .d-md-flex {
        flex-direction: column;
    }
    
    .d-md-flex .btn {
        width: 100%;
        margin-bottom: 0.5rem;
    }
}

@media (max-width: 576px) {
    .container {
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    .card-body {
        padding: 1rem !important;
    }
    
    .form-control,
    .form-select {
        padding: 0.75rem;
    }
}
</style>
{% endblock %}