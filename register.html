{% extends "base.html" %}
{% block title %}Register - QuickHire{% endblock %}
{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8">
            <div class="card-modern animate__animated animate__fadeIn">
                <div class="card-body p-4 p-md-5">
                    <h2 class="text-center mb-4">
                        <i class="fas fa-user-plus me-2 text-primary"></i>Join QuickHire
                    </h2>
                    
                    <!-- Role Selection -->
                    <div class="btn-group w-100 mb-4" role="group">
                        <input type="radio" class="btn-check" name="form_type" id="seeker" value="seeker" autocomplete="off" checked>
                        <label class="btn btn-outline-primary" for="seeker">
                            <i class="fas fa-user me-2"></i>Job Seeker
                        </label>
                        <input type="radio" class="btn-check" name="form_type" id="employer" value="employer" autocomplete="off">
                        <label class="btn btn-outline-primary" for="employer">
                            <i class="fas fa-user-tie me-2"></i>Employer
                        </label>
                    </div>

                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category == 'error' and 'danger' or 'success' }} alert-modern mb-4" role="alert">
                                    <i class="fas fa-{{ category == 'error' and 'exclamation-triangle' or 'check-circle' }} me-2"></i>
                                    {{ message }}
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <!-- Job Seeker Form -->
                    <div id="seeker-form">
                        <h3 class="text-center mb-4 text-gradient">Job Seeker Registration</h3>
                        <form method="POST" action="{{ url_for('register_seeker') }}" novalidate class="form-modern">
                            {{ seeker_form.hidden_tag() }}
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Full Name</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            {{ seeker_form.name(class="form-control", placeholder="Enter your full name") }}
                                        </div>
                                        {% if seeker_form.name.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ seeker_form.name.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Phone Number</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                            {{ seeker_form.phone(class="form-control", placeholder="9876543210") }}
                                        </div>
                                        {% if seeker_form.phone.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ seeker_form.phone.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold">Aadhaar Card Number</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                                    {{ seeker_form.aadhaar(class="form-control", placeholder="12-digit Aadhaar number", maxlength="12") }}
                                </div>
                                {% if seeker_form.aadhaar.errors %}
                                    <div class="text-danger small mt-2">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ seeker_form.aadhaar.errors[0] }}
                                    </div>
                                {% endif %}
                                <div class="form-text text-muted">12-digit Aadhaar number (numbers only)</div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Email Address (Optional)</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                            {{ seeker_form.email(class="form-control", placeholder="example@domain.com") }}
                                        </div>
                                        {% if seeker_form.email.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ seeker_form.email.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Years of Experience</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-briefcase"></i></span>
                                            {{ seeker_form.years_experience(class="form-control", placeholder="5") }}
                                        </div>
                                        {% if seeker_form.years_experience.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ seeker_form.years_experience.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Gender</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-venus-mars"></i></span>
                                            {{ seeker_form.gender(class="form-control") }}
                                        </div>
                                        {% if seeker_form.gender.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ seeker_form.gender.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Location</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                                            {{ seeker_form.location(class="form-control", placeholder="Aurangabad") }}
                                        </div>
                                        {% if seeker_form.location.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ seeker_form.location.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold">Skills</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-tools"></i></span>
                                    <select name="skills" class="form-control" id="seeker-skills">
                                        <option value="">Select your skill</option>
                                        <option value="Cooking">Cooking</option>
                                        <option value="Washing">Washing</option>
                                        <option value="Babysitting">Babysitting</option>
                                        <option value="Cleaning">Cleaning</option>
                                        <option value="Driving">Driving</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div id="seeker-other-skill" style="display:none; margin-top:10px;">
                                    <input type="text" name="other_skill" class="form-control" placeholder="Enter your skill">
                                </div>
                            </div>

                            <!-- Password Fields -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Password</label>
                                        <div class="password-input-group">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                                {{ seeker_form.password(class="form-control", id="seeker-password", placeholder="Enter password", oninput="validatePassword('seeker')") }}
                                            </div>
                                            <button type="button" class="toggle-password" onclick="togglePasswordVisibility('seeker-password', this)">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        
                                        <!-- Password Strength Meter -->
                                        <div class="password-strength-meter mt-2" id="seeker-strength-meter"></div>
                                        
                                        <!-- Password Requirements -->
                                        <div class="password-requirements mt-2" id="seeker-requirements">
                                            <div class="requirement invalid" id="seeker-length">
                                                <i class="fas fa-times"></i> At least 8 characters
                                            </div>
                                            <div class="requirement invalid" id="seeker-uppercase">
                                                <i class="fas fa-times"></i> One uppercase letter
                                            </div>
                                            <div class="requirement invalid" id="seeker-lowercase">
                                                <i class="fas fa-times"></i> One lowercase letter
                                            </div>
                                            <div class="requirement invalid" id="seeker-number">
                                                <i class="fas fa-times"></i> One number
                                            </div>
                                            <div class="requirement invalid" id="seeker-special">
                                                <i class="fas fa-times"></i> One special character
                                            </div>
                                        </div>
                                        
                                        {% if seeker_form.password.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ seeker_form.password.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Confirm Password</label>
                                        <div class="password-input-group">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                                {{ seeker_form.confirm_password(class="form-control", id="seeker-confirm-password", placeholder="Confirm password", oninput="validatePasswordMatch('seeker')") }}
                                            </div>
                                            <button type="button" class="toggle-password" onclick="togglePasswordVisibility('seeker-confirm-password', this)">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div class="password-requirements mt-2">
                                            <div class="requirement invalid" id="seeker-match">
                                                <i class="fas fa-times"></i> Passwords match
                                            </div>
                                        </div>
                                        {% if seeker_form.confirm_password.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ seeker_form.confirm_password.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn-modern btn-primary-modern w-100 py-2">
                                <i class="fas fa-check me-2"></i>Register as Job Seeker
                            </button>
                        </form>
                    </div>

                    <!-- Employer Form -->
                    <div id="employer-form" style="display: none;">
                        <h3 class="text-center mb-4 text-gradient">Employer Registration</h3>
                        <form method="POST" action="{{ url_for('register_employer') }}" novalidate class="form-modern">
                            {{ employer_form.hidden_tag() }}
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Full Name</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            {{ employer_form.name(class="form-control", placeholder="Enter your full name") }}
                                        </div>
                                        {% if employer_form.name.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ employer_form.name.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Phone Number</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                            {{ employer_form.phone(class="form-control", placeholder="9876543210") }}
                                        </div>
                                        {% if employer_form.phone.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ employer_form.phone.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold">Aadhaar Card Number</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                                    {{ employer_form.aadhaar(class="form-control", placeholder="12-digit Aadhaar number", maxlength="12") }}
                                </div>
                                {% if employer_form.aadhaar.errors %}
                                    <div class="text-danger small mt-2">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ employer_form.aadhaar.errors[0] }}
                                    </div>
                                {% endif %}
                                <div class="form-text text-muted">12-digit Aadhaar number (numbers only)</div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Company Name (Optional)</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-building"></i></span>
                                            {{ employer_form.company_name(class="form-control", placeholder="Your company name") }}
                                        </div>
                                        {% if employer_form.company_name.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ employer_form.company_name.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Email Address</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                            {{ employer_form.email(class="form-control", placeholder="company@example.com") }}
                                        </div>
                                        {% if employer_form.email.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ employer_form.email.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold">Location</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                                    {{ employer_form.location(class="form-control", placeholder="Aurangabad") }}
                                </div>
                                {% if employer_form.location.errors %}
                                    <div class="text-danger small mt-2">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ employer_form.location.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Password Fields -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Password</label>
                                        <div class="password-input-group">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                                {{ employer_form.password(class="form-control", id="employer-password", placeholder="Enter password", oninput="validatePassword('employer')") }}
                                            </div>
                                            <button type="button" class="toggle-password" onclick="togglePasswordVisibility('employer-password', this)">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        
                                        <!-- Password Strength Meter -->
                                        <div class="password-strength-meter mt-2" id="employer-strength-meter"></div>
                                        
                                        <!-- Password Requirements -->
                                        <div class="password-requirements mt-2" id="employer-requirements">
                                            <div class="requirement invalid" id="employer-length">
                                                <i class="fas fa-times"></i> At least 8 characters
                                            </div>
                                            <div class="requirement invalid" id="employer-uppercase">
                                                <i class="fas fa-times"></i> One uppercase letter
                                            </div>
                                            <div class="requirement invalid" id="employer-lowercase">
                                                <i class="fas fa-times"></i> One lowercase letter
                                            </div>
                                            <div class="requirement invalid" id="employer-number">
                                                <i class="fas fa-times"></i> One number
                                            </div>
                                            <div class="requirement invalid" id="employer-special">
                                                <i class="fas fa-times"></i> One special character
                                            </div>
                                        </div>
                                        
                                        {% if employer_form.password.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ employer_form.password.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Confirm Password</label>
                                        <div class="password-input-group">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                                {{ employer_form.confirm_password(class="form-control", id="employer-confirm-password", placeholder="Confirm password", oninput="validatePasswordMatch('employer')") }}
                                            </div>
                                            <button type="button" class="toggle-password" onclick="togglePasswordVisibility('employer-confirm-password', this)">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div class="password-requirements mt-2">
                                            <div class="requirement invalid" id="employer-match">
                                                <i class="fas fa-times"></i> Passwords match
                                            </div>
                                        </div>
                                        {% if employer_form.confirm_password.errors %}
                                            <div class="text-danger small mt-2">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ employer_form.confirm_password.errors[0] }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn-modern btn-primary-modern w-100 py-2">
                                <i class="fas fa-check me-2"></i>Register as Employer
                            </button>
                        </form>
                    </div>

                    <p class="text-center mt-4">
                        Already have an account? 
                        <a href="{{ url_for('login') }}" class="text-primary text-decoration-none fw-bold">Login here</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Form toggle functionality
document.addEventListener('DOMContentLoaded', function() {
    const seekerRadio = document.getElementById('seeker');
    const employerRadio = document.getElementById('employer');
    const seekerForm = document.getElementById('seeker-form');
    const employerForm = document.getElementById('employer-form');

    function toggleForms() {
        if (seekerRadio.checked) {
            seekerForm.style.display = 'block';
            employerForm.style.display = 'none';
        } else {
            seekerForm.style.display = 'none';
            employerForm.style.display = 'block';
        }
    }

    seekerRadio.addEventListener('change', toggleForms);
    employerRadio.addEventListener('change', toggleForms);

    // Skills dropdown functionality
    const seekerSkills = document.getElementById('seeker-skills');
    const seekerOtherSkill = document.getElementById('seeker-other-skill');
    
    if (seekerSkills && seekerOtherSkill) {
        seekerSkills.addEventListener('change', function() {
            if (this.value === 'Other') {
                seekerOtherSkill.style.display = 'block';
            } else {
                seekerOtherSkill.style.display = 'none';
                seekerOtherSkill.querySelector('input').value = '';
            }
        });
    }

    // Aadhaar validation - numbers only
    const aadhaarInputs = document.querySelectorAll('input[name="aadhaar"]');
    aadhaarInputs.forEach(input => {
        input.addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '');
            if (this.value.length > 12) {
                this.value = this.value.slice(0, 12);
            }
        });
    });
});

// Password validation functions
function validatePassword(formType) {
    const password = document.getElementById(`${formType}-password`).value;
    const strengthMeter = document.getElementById(`${formType}-strength-meter`);
    const requirements = document.getElementById(`${formType}-requirements`);
    
    // Reset strength meter
    strengthMeter.className = 'password-strength-meter';
    
    // Check individual requirements
    const hasLength = password.length >= 8;
    const hasUppercase = /[A-Z]/.test(password);
    const hasLowercase = /[a-z]/.test(password);
    const hasNumber = /[0-9]/.test(password);
    const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);
    
    // Update requirement indicators
    updateRequirement(`${formType}-length`, hasLength);
    updateRequirement(`${formType}-uppercase`, hasUppercase);
    updateRequirement(`${formType}-lowercase`, hasLowercase);
    updateRequirement(`${formType}-number`, hasNumber);
    updateRequirement(`${formType}-special`, hasSpecial);
    
    // Calculate strength score
    let strength = 0;
    if (hasLength) strength++;
    if (hasUppercase) strength++;
    if (hasLowercase) strength++;
    if (hasNumber) strength++;
    if (hasSpecial) strength++;
    
    // Update strength meter
    if (strength <= 2) {
        strengthMeter.className = 'password-strength-meter strength-weak';
    } else if (strength <= 4) {
        strengthMeter.className = 'password-strength-meter strength-medium';
    } else {
        strengthMeter.className = 'password-strength-meter strength-strong';
    }
    
    // Also validate password match
    validatePasswordMatch(formType);
}

function validatePasswordMatch(formType) {
    const password = document.getElementById(`${formType}-password`).value;
    const confirmPassword = document.getElementById(`${formType}-confirm-password`).value;
    const matchElement = document.getElementById(`${formType}-match`);
    
    const passwordsMatch = password === confirmPassword && password.length > 0;
    updateRequirement(`${formType}-match`, passwordsMatch);
}

function updateRequirement(elementId, isValid) {
    const element = document.getElementById(elementId);
    if (element) {
        if (isValid) {
            element.className = 'requirement valid';
            element.innerHTML = `<i class="fas fa-check"></i> ${element.textContent.replace('✗', '').replace('✓', '').trim()}`;
        } else {
            element.className = 'requirement invalid';
            element.innerHTML = `<i class="fas fa-times"></i> ${element.textContent.replace('✗', '').replace('✓', '').trim()}`;
        }
    }
}

function togglePasswordVisibility(inputId, button) {
    const input = document.getElementById(inputId);
    const icon = button.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.className = 'fas fa-eye-slash';
    } else {
        input.type = 'password';
        icon.className = 'fas fa-eye';
    }
}

// Form submission validation
document.addEventListener('DOMContentLoaded', function() {
    const seekerForm = document.querySelector('#seeker-form form');
    const employerForm = document.querySelector('#employer-form form');
    
    if (seekerForm) {
        seekerForm.addEventListener('submit', function(e) {
            if (!validateFormBeforeSubmit('seeker')) {
                e.preventDefault();
            }
        });
    }
    
    if (employerForm) {
        employerForm.addEventListener('submit', function(e) {
            if (!validateFormBeforeSubmit('employer')) {
                e.preventDefault();
            }
        });
    }
});

function validateFormBeforeSubmit(formType) {
    const password = document.getElementById(`${formType}-password`).value;
    const confirmPassword = document.getElementById(`${formType}-confirm-password`).value;
    
    // Check all requirements
    const hasLength = password.length >= 8;
    const hasUppercase = /[A-Z]/.test(password);
    const hasLowercase = /[a-z]/.test(password);
    const hasNumber = /[0-9]/.test(password);
    const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);
    const passwordsMatch = password === confirmPassword;
    
    if (!hasLength || !hasUppercase || !hasLowercase || !hasNumber || !hasSpecial || !passwordsMatch) {
        alert('Please ensure your password meets all requirements:\n\n• At least 8 characters\n• One uppercase letter (A-Z)\n• One lowercase letter (a-z)\n• One number (0-9)\n• One special character (!@#$%^&* etc.)\n• Passwords must match');
        return false;
    }
    
    return true;
}
</script>
{% endblock %}